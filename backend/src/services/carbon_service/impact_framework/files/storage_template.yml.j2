name: {{ name }}
aggregation:
  metrics:
    - carbon
    - energy
    - carbon-operational
    - carbon-embodied
    - storage/power
  type: {{ aggregation_type }}
initialize:
  plugins:
    {%- for model in hardware_models %}
      {{ model }}:
        method: {{ hardware_models[model].model }}
        path: {{ hardware_models[model].path }}
        {%- if hardware_models[model].config %}
        config: 
          {%- for key, value in hardware_models[model].config.items() %}
            {%- if value is mapping %}
            {{ key }}:
              {%- for sub_key, sub_value in value.items() %}
              {{ sub_key }}: {{ sub_value }}
              {%- endfor %}
            {%- else %}
            {{ key }}: {{ value }}
            {%- endif %}
          {%- endfor %}
        {%- endif %}
        {%- if hardware_models[model].output_metadata or hardware_models[model].input_metadata %}
        parameter-metadata: 
            {%- if hardware_models[model].output_metadata %}
            outputs:
              {%- for metadata in hardware_models[model].output_metadata %}
              {{ metadata.aggregation_parameter }}:
                unit: {{ metadata.unit }}
                description: {{ metadata.description }}
                aggregation-method: 
                  time: {{ metadata.aggregation_method_time }}
                  component: {{ metadata.aggregation_method_component }}
              {%- endfor %}
            {%- endif %}
            {%- if hardware_models[model].input_metadata %}
            inputs:
              {%- for metadata in hardware_models[model].input_metadata %}
              {{ metadata.aggregation_parameter }}:
                unit: {{ metadata.unit }}
                description: {{ metadata.description }}
                aggregation-method: 
                  time: {{ metadata.aggregation_method_time }}
                  component: {{ metadata.aggregation_method_component }}
              {%- endfor %}
            {%- endif %}
        {%- endif %}
    {%- endfor %}
  outputs:
    - yaml
tree:
  defaults:
    device/expected-lifespan: 126230400
    duration: {{ duration }}
  pipeline:
    compute:
    {%- for model in hardware_models %}
    - {{ model }}
    {%- endfor %}
  children:
    {%- for storage_id, storage_data in resources.items() %}
      {{ storage_id }}:
        inputs:
          {% for time_point in storage_data %}
            -
            {%- for key, value in time_point.items() %}
              {%- if key == "timestamp" %}
              {{ key }}: "{{ value }}"
              {%- else %}
              {{ key }}: {{ value }}
              {%- endif %}
            {%- endfor %}
          {%- endfor %}
    {%- endfor %}